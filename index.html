<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Numerology Analysis | Fauzan Tarot</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #0f0518;
            --gold-accent: #d4af37;
            --gold-light: #f3e5ab;
            --text-main: #e0e0e0;
            --glass-bg: rgba(20, 5, 30, 0.96);
            --red-karmic: #ff6b6b;
            --blue-cycle: #81a1c1;
        }

        body {
            font-family: 'Lora', serif; display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; background-color: var(--bg-dark); color: var(--text-main); margin: 0; padding: 20px;
        }

        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://i.imgur.com/XMpaq1Z.jpeg');
            background-size: cover; background-position: center; filter: brightness(0.2) blur(8px); z-index: -1;
        }

        .container {
            background-color: var(--glass-bg); padding: 40px; border-radius: 20px;
            border: 1px solid rgba(212, 175, 55, 0.3); max-width: 1000px; width: 100%;
            text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.8); margin-bottom: 50px;
        }

        h1 { font-family: 'Playfair Display', serif; color: var(--gold-accent); margin-bottom: 10px; font-size: 2.2rem;}
        .subtitle { color: #888; font-size: 0.9rem; margin-bottom: 30px; letter-spacing: 1px; }

        /* INPUTS */
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; text-align: left; margin-bottom: 20px; }
        label { display: block; color: var(--gold-light); margin-bottom: 5px; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; }
        input { 
            width: 100%; padding: 15px; background: rgba(255,255,255,0.05); 
            border: 1px solid rgba(212, 175, 55, 0.4); border-radius: 8px; 
            color: white; outline: none; box-sizing: border-box;
        }

        button { 
            width: 100%; padding: 20px; background: var(--gold-accent); color: var(--bg-dark); 
            border: none; border-radius: 8px; font-family: 'Playfair Display', serif; font-weight: bold; 
            font-size: 1.2rem; cursor: pointer; transition: 0.3s; margin-top: 10px; letter-spacing: 2px;
        }
        button:hover { background: var(--gold-light); transform: translateY(-2px); }

        /* HASIL */
        .results-container { display: none; text-align: left; margin-top: 50px; animation: fadeIn 1s ease; }
        
        .section-header {
            border-bottom: 1px solid rgba(212,175,55,0.3); padding-bottom: 10px; margin-top: 60px; margin-bottom: 25px;
        }
        .section-header h2 { font-family: 'Playfair Display', serif; color: var(--gold-light); margin: 0; font-size: 1.8rem; }
        .section-header p { margin: 5px 0 0 0; color: #888; font-size: 0.9rem; }

        /* CARD STYLE */
        .result-card {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
            padding: 25px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid var(--gold-accent);
        }
        .head-row { display: flex; align-items: flex-start; gap: 20px; margin-bottom: 15px; }
        .big-num { 
            font-family: 'Playfair Display', serif; font-size: 3.5rem; line-height: 1; 
            color: var(--gold-accent); font-weight: bold; min-width: 60px; text-align: center;
        }
        .title-col h3 { margin: 0; color: var(--gold-light); font-size: 1.2rem; }
        .title-col span { font-size: 0.8rem; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }

        .meaning { font-size: 0.95rem; line-height: 1.7; color: #d0d0d0; }
        
        /* TAGS */
        .tag-area { margin-top: 10px; }
        .tag { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; margin-right: 5px; }
        .tag-karmic { background: rgba(255, 107, 107, 0.15); color: var(--red-karmic); border: 1px solid var(--red-karmic); }
        .tag-master { background: rgba(212, 175, 55, 0.15); color: var(--gold-accent); border: 1px solid var(--gold-accent); }
        
        .karmic-box {
            margin-top: 15px; padding: 15px; background: rgba(255, 107, 107, 0.05);
            border: 1px dashed var(--red-karmic); border-radius: 8px; color: #ffcccc; font-size: 0.9rem;
        }

        /* TABLE */
        .cycle-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        .cycle-table th, .cycle-table td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); text-align: left; }
        .cycle-table th { color: var(--gold-light); font-family: 'Playfair Display', serif; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @media(max-width:600px){ .head-row{ flex-direction:column; gap:10px; } .big-num{ text-align:left; } }
    </style>
</head>
<body>

    <a href="https://fauzantarot.github.io/" style="color: var(--gold-light); text-decoration: none; align-self: flex-start; margin-bottom: 20px;">‚Üê Kembali ke Beranda</a>

    <div class="container">
        <h1>Deep Numerology Profile</h1>
        <div class="subtitle">Analisis Mendalam: Core, Karmic, Bridge & Cycles</div>
        
        <div class="input-grid">
            <div>
                <label>Nama Lengkap (Sesuai Akte)</label>
                <input type="text" id="fullName" placeholder="Nama Lengkap...">
            </div>
            <div>
                <label>Nama Panggilan</label>
                <input type="text" id="nickName" placeholder="Nama Panggilan...">
            </div>
            <div>
                <label>Tanggal Lahir</label>
                <input type="date" id="birthDate">
            </div>
        </div>

        <button onclick="calculateDeepProfile()">BACA ANALISIS SAYA</button>

        <div id="resultArea" class="results-container">
            
            <div class="section-header">
                <h2>1. The Core Numbers (Inti Diri)</h2>
                <p>Fondasi utama kepribadian, tujuan hidup, dan keinginan jiwa Anda.</p>
            </div>

            <div id="coreResults"></div>

            <div class="section-header">
                <h2>2. Bridge & Synthesis (Penyelarasan)</h2>
                <p>Bagaimana menyeimbangkan diri dan arah di usia matang.</p>
            </div>
            <div id="bridgeResults"></div>

            <div class="section-header">
                <h2>3. Karmic Analysis (Analisis Karma)</h2>
                <p>Pelajaran masa lalu dan area yang perlu diperkuat.</p>
            </div>
            <div class="result-card">
                <div class="title-col"><h3>Karmic Lessons (Angka Hilang)</h3></div>
                <div id="lessonsArea" style="margin-top:10px;"></div>
                <div class="meaning" style="margin-top:10px; font-size:0.85rem; color:#aaa;">Angka-angka ini tidak ada dalam nama Anda. Ini menunjukkan area kelemahan yang harus dilatih secara sadar.</div>
            </div>
            <div id="debtResults"></div>

            <div class="section-header">
                <h2>4. Cycles & Timing (Siklus Waktu)</h2>
                <p>Prediksi energi tahunan dan fase kehidupan.</p>
            </div>
            <div id="timingResults"></div>

            <div class="result-card" style="padding:0; overflow:hidden;">
                <table class="cycle-table">
                    <thead>
                        <tr><th>Fase Hidup</th><th>Usia</th><th>Puncak (Pinnacle)</th><th>Tantangan (Challenge)</th></tr>
                    </thead>
                    <tbody id="pinnacleBody"></tbody>
                </table>
                <div id="cycleList" style="margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;"></div>
            </div>

        </div>
    </div>

    <script>
        // --- DATA INTERPRETASI (DATABASE) ---
        const interpretations = {
            1: { keyword: "Pemimpin & Perintis", desc: "Energi kemandirian, inisiatif, dan kepemimpinan. Anda didorong untuk berdiri di atas kaki sendiri, orisinal, dan berani mengambil jalan yang berbeda dari orang lain.", lesson: "Belajar percaya diri dan tidak bergantung pada orang lain." },
            2: { keyword: "Diplomat & Pasangan", desc: "Energi kerja sama, kepekaan, dan harmoni. Kekuatan Anda terletak pada detail, intuisi, dan kemampuan menyatukan orang. Anda adalah pembawa damai.", lesson: "Belajar menetapkan batasan dan tidak terlalu sensitif." },
            3: { keyword: "Komunikator & Kreator", desc: "Energi ekspresi diri, kegembiraan, dan kreativitas. Anda memiliki bakat dalam kata-kata, seni, dan menghibur orang lain. Pesona sosial Anda tinggi.", lesson: "Belajar fokus dan tidak menyebarkan energi terlalu tipis." },
            4: { keyword: "Pembangun & Praktisi", desc: "Energi stabilitas, kerja keras, dan sistem. Anda adalah fondasi yang kokoh, disiplin, dan terorganisir. Anda mewujudkan ide menjadi bentuk nyata.", lesson: "Belajar fleksibel dan tidak terlalu kaku." },
            5: { keyword: "Petualang & Pembebas", desc: "Energi kebebasan, perubahan, dan adaptabilitas. Anda menyukai variasi, travel, dan pengalaman baru. Rutinitas adalah musuh Anda.", lesson: "Belajar disiplin diri dan komitmen." },
            6: { keyword: "Pengasuh & Harmoni", desc: "Energi tanggung jawab, keluarga, dan pelayanan. Anda berorientasi pada rumah, menyembuhkan, dan menjaga keharmonisan komunitas.", lesson: "Belajar tidak terlalu mencampuri urusan orang lain (perfeksionisme)." },
            7: { keyword: "Pencari & Pemikir", desc: "Energi analisis, spiritualitas, dan introspeksi. Anda mencari kebenaran terdalam. Anda butuh waktu sendiri untuk mengisi ulang energi.", lesson: "Belajar mempercayai intuisi dan terbuka pada orang lain." },
            8: { keyword: "Eksekutif & Kekuasaan", desc: "Energi ambisi, uang, dan otoritas. Anda memiliki bakat manajemen dan visi besar. Tujuan Anda adalah kesuksesan materi yang seimbang.", lesson: "Belajar menyeimbangkan materi dan spiritual." },
            9: { keyword: "Humanis & Penutup", desc: "Energi kasih sayang universal, kedermawanan, dan penyelesaian. Anda peduli pada gambaran besar dan kesejahteraan banyak orang.", lesson: "Belajar melepaskan masa lalu dan memberi tanpa pamrih." },
            11: { keyword: "Master Illuminator", desc: "Intuisi tingkat tinggi dan pencerahan spiritual. Anda di sini untuk menginspirasi orang lain melalui visi idealis Anda.", lesson: "Menyeimbangkan saraf yang tegang dengan grounding." },
            22: { keyword: "Master Builder", desc: "Potensi mewujudkan mimpi besar menjadi kenyataan nyata untuk kemaslahatan banyak orang. Gabungan visi idealis dan praktikalitas.", lesson: "Mengatasi ketakutan akan kegagalan besar." },
            33: { keyword: "Master Teacher", desc: "Energi pengabdian dan cinta kasih tanpa syarat. Anda adalah penyembuh kosmik yang mengajarkan cinta melalui teladan.", lesson: "Tidak mengorbankan diri sendiri secara berlebihan." }
        };

        // --- DATA BARU: PINNACLE & CHALLENGE ---
        const pinnacleMeanings = {
            1: "Periode Mandiri. Waktunya memimpin, berdiri sendiri, dan memulai hal baru.",
            2: "Periode Diplomasi. Sukses lewat kerjasama, detail, dan kepekaan rasa.",
            3: "Periode Kreatif. Waktunya berekspresi, menulis, seni, dan bersosialisasi.",
            4: "Periode Kerja Keras. Waktunya membangun fondasi, disiplin, dan ketertiban.",
            5: "Periode Kebebasan. Banyak perubahan mendadak, travel, dan adaptasi.",
            6: "Periode Keluarga. Fokus pada rumah tangga, pernikahan, dan tanggung jawab.",
            7: "Periode Introspeksi. Waktu untuk menyendiri, belajar spiritual, dan analisis.",
            8: "Periode Kesuksesan. Fokus pada karir, uang, bisnis, dan kekuasaan.",
            9: "Periode Pengabdian. Melayani orang banyak, beramal, dan melepas masa lalu.",
            11: "Periode Pencerahan (Master). Menjadi inspirasi spiritual bagi orang lain.",
            22: "Periode Membangun Besar (Master). Mewujudkan mimpi besar bagi dunia."
        };

        const challengeMeanings = {
            0: "Tantangan Pilihan. Bingung memilih arah hidup karena merasa bisa segalanya.",
            1: "Tantangan Ego. Belajar tegas tanpa menjadi sombong atau dominan.",
            2: "Tantangan Sensitivitas. Belajar tidak mudah tersinggung (baperan).",
            3: "Tantangan Fokus. Belajar tidak membuang energi dan menyembunyikan perasaan.",
            4: "Tantangan Disiplin. Belajar menyukai keteraturan dan tidak malas.",
            5: "Tantangan Impulsif. Belajar komitmen dan tidak lari dari masalah.",
            6: "Tantangan Perfeksionis. Belajar menerima kekurangan orang lain/keluarga.",
            7: "Tantangan Skeptis. Belajar mempercayai diri sendiri dan Tuhan (iman).",
            8: "Tantangan Materi. Belajar tidak menilai segala sesuatu dari uang."
        };
    

        const karmicDebtsText = {
            13: "Hutang Kerja Keras (13/4): Arti Masa Lalu: Indikasi bahwa di masa lalu ada kecenderungan bermalas-malasan atau melimpahkan tanggung jawab. Tantangan: Hidup terasa lebih berat, banyak rintangan berulang. Pelajaran: Disiplin, Fokus, dan Kerja Keras tanpa jalan pintas.",
            14: "Hutang Kebebasan (14/5): Arti Masa Lalu: Penyalahgunaan kebebasan atau lari dari komitmen. Tantangan: Hidup penuh perubahan mendadak, drama, atau masalah kecanduan. Pelajaran: Moderasi dan Komitmen. Tetap fleksibel tapi bertanggung jawab.",
            16: "Hutang Kehancuran Ego (16/7): Arti Masa Lalu: Ego tinggi atau pengkhianatan cinta. Tantangan: Seperti kartu The Tower, apa yang dibangun bisa runtuh mendadak untuk menghancurkan ego. Pelajaran: Kerendahan hati dan mencari makna spiritual di atas materi.",
            19: "Hutang Kekuasaan (19/1): Arti Masa Lalu: Penyalahgunaan kekuasaan atau egois ekstrem. Tantangan: Merasa terisolasi dan harus melakukan semua sendirian, sulit minta tolong. Pelajaran: Saling ketergantungan. Belajar menerima bantuan orang lain."
        };

        const personalYearText = {
            1: "Personal Year 1: Tahun Awal Baru. Tema: Kemandirian dan inisiatif. Tantangan: Keraguan diri. Kunci Sukses: Ambil tindakan berani untuk menanam benih 9 tahun ke depan.",
            2: "Personal Year 2: Tahun Kesabaran. Tema: Diplomasi dan kerjasama. Tantangan: Penundaan dan rasa sensitif. Kunci Sukses: Tetap tenang dan jaga harmoni hubungan.",
            3: "Personal Year 3: Tahun Ekspresi. Tema: Kreativitas dan sosial. Tantangan: Hilang fokus. Kunci Sukses: Nikmati hidup tapi jangan hamburkan energi.",
            4: "Personal Year 4: Tahun Kerja Keras. Tema: Fondasi dan ketertiban. Tantangan: Rasa terkekang rutinitas. Kunci Sukses: Disiplin dan perhatian pada detail.",
            5: "Personal Year 5: Tahun Perubahan. Tema: Kebebasan dan petualangan. Tantangan: Impulsif dan tidak stabil. Kunci Sukses: Adaptasi dengan perubahan tak terduga.",
            6: "Personal Year 6: Tahun Tanggung Jawab. Tema: Keluarga dan pengasuhan. Tantangan: Beban emosional. Kunci Sukses: Melayani dengan cinta tanpa mengeluh.",
            7: "Personal Year 7: Tahun Introspeksi. Tema: Spiritual dan analisis. Tantangan: Kesepian. Kunci Sukses: Gunakan waktu sendiri untuk belajar dan evaluasi diri.",
            8: "Personal Year 8: Tahun Pencapaian. Tema: Karir dan uang. Tantangan: Ambisi buta. Kunci Sukses: Manajemen efisien dan keseimbangan materi-spiritual.",
            9: "Personal Year 9: Tahun Penyelesaian. Tema: Melepaskan dan memaafkan. Tantangan: Sulit move on. Kunci Sukses: Bersihkan hidup dari yang tak berguna untuk siklus baru.",
            11: "Personal Year 11/2: Tahun Pencerahan (Master). Tema: Intuisi tajam. Tantangan: Kecemasan tinggi. Kunci Sukses: Percayai firasat batin.",
            22: "Personal Year 22/4: Tahun Membangun (Master). Tema: Visi besar jadi nyata. Tantangan: Beban kerja berat. Kunci Sukses: Kerja sistematis untuk tujuan besar.",
            33: "Personal Year 33/6: Tahun Pengabdian (Master). Tema: Cinta kasih universal. Tantangan: Emosi meluap. Kunci Sukses: Melayani orang banyak dengan tulus."
        };

        // --- UTILS ---
        const charMap = {'A':1,'J':1,'S':1,'B':2,'K':2,'T':2,'C':3,'L':3,'U':3,'D':4,'M':4,'V':4,'E':5,'N':5,'W':5,'F':6,'O':6,'X':6,'G':7,'P':7,'Y':7,'H':8,'Q':8,'Z':8,'I':9,'R':9};
        const vowelsList = ['A','E','I','O','U'];

        function reduce(num, checkMaster=true) {
            let n = parseInt(num);
            if (isNaN(n)) return {val:0, karmic:null}; // Safety check
            
            if(checkMaster && [11,22,33].includes(n)) return {val:n, karmic:null};
            
            let karmic = null;
            let original = n;
            
            // Loop reduction
            while(n > 9) {
                if([13,14,16,19].includes(n)) karmic = n;
                let str = n.toString();
                let sum = 0;
                for(let i=0; i<str.length; i++) sum += parseInt(str.charAt(i));
                n = sum;
                if(checkMaster && [11,22,33].includes(n)) return {val:n, karmic:karmic};
            }
            
            if([13,14,16,19].includes(original)) karmic = original;
            return {val:n, karmic:karmic};
        }

        function getSum(str) {
            if(!str) return 0;
            return str.replace(/[^A-Z]/g,'').split('').reduce((acc,c)=>acc+(charMap[c]||0),0);
        }

        function getMeaning(num, type='general') {
            if(!interpretations[num]) return "Energi unik dan kompleks.";
            if(type === 'lesson') return interpretations[num].lesson;
            if(type === 'keyword') return interpretations[num].keyword;
            return interpretations[num].desc;
        }

        function createCard(title, subtitle, resObj) {
            let karmicHtml = resObj.karmic ? `<div class="karmic-box">‚ö†Ô∏è <strong>Karmic Debt ${resObj.karmic}</strong><br>${karmicDebtsText[resObj.karmic]}</div>` : '';
            let tagHtml = resObj.karmic ? `<span class="tag tag-karmic">Karmic</span>` : '';
            if([11,22,33].includes(resObj.val)) tagHtml += `<span class="tag tag-master">Master</span>`;

            return `
            <div class="result-card">
                <div class="head-row">
                    <div class="big-num">${resObj.val}</div>
                    <div class="title-col">
                        <span>${subtitle}</span>
                        <h3>${title}</h3>
                        <div class="tag-area">${tagHtml}</div>
                    </div>
                </div>
                <div class="meaning">
                    <strong>${getMeaning(resObj.val, 'keyword')}</strong><br>
                    ${getMeaning(resObj.val, 'general')}
                </div>
                ${karmicHtml}
            </div>`;
        }

        // --- FUNGSI BARU: GENERATOR DESKRIPSI (Diletakkan di luar calculateDeepProfile) ---
        function generateCycleDesc(phaseName, ageRange, pVal, cVal) {
            return `
            <div style="margin-bottom: 25px;">
                <h4 style="color:var(--gold-light); margin-bottom:5px; border-left:3px solid var(--gold-accent); padding-left:10px;">
                    ${phaseName} (Usia ${ageRange})
                </h4>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; font-size:0.9rem;">
                    <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:5px;">
                        <strong style="color:var(--gold-accent);">üöÄ Puncak ${pVal}:</strong><br>
                        ${pinnacleMeanings[pVal] || "Energi transisi."}
                    </div>
                    <div style="background:rgba(255,100,100,0.1); padding:10px; border-radius:5px;">
                        <strong style="color:var(--red-karmic);">üî• Tantangan ${cVal}:</strong><br>
                        ${challengeMeanings[cVal] || "Tantangan unik."}
                    </div>
                </div>
            </div>`;
        }

        // --- CALCULATION ---
        function calculateDeepProfile() {
            try {
                // 1. AMBIL INPUT
                const nameInput = document.getElementById('fullName').value;
                const nickInput = document.getElementById('nickName').value;
                const dateInput = document.getElementById('birthDate').value;

                // 2. CEK KELENGKAPAN
                if(!nameInput || !dateInput) { 
                    alert("Mohon lengkapi Nama Lengkap dan Tanggal Lahir."); 
                    return; 
                }

                const fullName = nameInput.toUpperCase();
                const nickName = nickInput ? nickInput.toUpperCase() : "";

                const date = new Date(dateInput);
                const D = date.getDate(); 
                const M = date.getMonth()+1; 
                const Y = date.getFullYear();
                const curY = new Date().getFullYear();

                // 3. HITUNG CORE
                const lpVal = reduce(reduce(D).val + reduce(M).val + reduce(Y).val);
                const birthVal = reduce(D, true);
                
                const cleanName = fullName.replace(/[^A-Z]/g,'');
                const vowels = cleanName.split('').filter(c=>vowelsList.includes(c)).join('');
                const consonants = cleanName.split('').filter(c=>!vowelsList.includes(c)).join('');

                const destVal = reduce(getSum(cleanName));
                const soulVal = reduce(getSum(vowels));
                const persVal = reduce(getSum(consonants));
                
                let minorVal = nickName ? reduce(getSum(nickName)) : {val:'-'};

                // 4. RENDER CORE CARDS
                let coreHtml = '';
                coreHtml += createCard("Life Path Number", "Jalan Hidup Utama", lpVal);
                coreHtml += createCard("Expression (Destiny)", "Bakat & Potensi", destVal);
                coreHtml += createCard("Soul Urge", "Keinginan Hati", soulVal);
                coreHtml += createCard("Personality", "Citra Publik", persVal);
                coreHtml += createCard("Birthday Number", "Bakat Pendukung", birthVal);
                
                if(nickName) {
                    coreHtml += `<div class="result-card" style="border-left-color:var(--blue-cycle);">
                        <div class="head-row"><div class="big-num">${minorVal.val}</div>
                        <div class="title-col"><h3>Minor Expression</h3><span>Energi Sehari-hari (${nickName})</span></div></div>
                        <div class="meaning">${getMeaning(minorVal.val)}</div>
                    </div>`;
                }
                document.getElementById('coreResults').innerHTML = coreHtml;

                // 5. RENDER BRIDGE
                const matureVal = reduce(lpVal.val + destVal.val);
                const nameParts = fullName.split(' ').filter(p=>p.length>0);
                let balSum = 0; 
                nameParts.forEach(p => {
                    if(p.length > 0) balSum += (charMap[p.charAt(0)] || 0);
                });
                const balVal = reduce(balSum);

                let bridgeHtml = '';
                bridgeHtml += createCard("Maturity Number", "Tujuan Usia Matang (40+)", matureVal);
                bridgeHtml += createCard("Balance Number", "Respon Terhadap Krisis", balVal);
                document.getElementById('bridgeResults').innerHTML = bridgeHtml;

                // 6. RENDER KARMIC LESSONS
                let present = new Set(cleanName.split('').map(c=>charMap[c]));
                let missing = [];
                for(let i=1; i<=9; i++) if(!present.has(i)) missing.push(i);
                
                let lessonHtml = '';
                if(missing.length === 0) lessonHtml = "<em>Tidak ada angka hilang. Jiwa yang lengkap (Well-rounded).</em>";
                else {
                    missing.forEach(n => {
                        lessonHtml += `<div style="margin-bottom:10px;">
                            <span class="tag tag-karmic" style="font-size:0.9rem;">Angka ${n}</span>
                            <span style="font-size:0.9rem; color:#ccc;">${getMeaning(n, 'lesson')}</span>
                        </div>`;
                    });
                }
                document.getElementById('lessonsArea').innerHTML = lessonHtml;
                document.getElementById('debtResults').innerHTML = ""; 

                // 7. RENDER TIMING
                const pyVal = reduce(reduce(D).val + reduce(M).val + reduce(curY).val);
                let pyMeaning = personalYearText[pyVal.val] || personalYearText[reduce(pyVal.val, false).val] || "Transisi.";
                
                let timingHtml = `
                <div class="result-card" style="border-left-color:var(--blue-cycle);">
                    <div class="head-row">
                        <div class="big-num">${pyVal.val}</div>
                        <div class="title-col"><span>Tema Tahun ${curY}</span><h3>Personal Year</h3></div>
                    </div>
                    <div class="meaning">${pyMeaning}</div>
                </div>`;
                document.getElementById('timingResults').innerHTML = timingHtml;

                // 8. RENDER PINNACLES TABLE (FIXED LOGIC)
                const bM = reduce(M,false).val; const bD = reduce(D,false).val; const bY = reduce(Y,false).val;
                const p1 = reduce(bM+bD).val; const p2 = reduce(bD+bY).val; const p3 = reduce(p1+p2).val; const p4 = reduce(bM+bY).val;
                const c1 = Math.abs(bM-bD); const c2 = Math.abs(bD-bY); const c3 = Math.abs(c1-c2); const c4 = Math.abs(bM-bY);
                
                let lpD = reduce(lpVal.val, false).val;
                if(lpD === 0) lpD = 1; 
                const a1 = 36 - lpD; 
                const a2 = a1 + 9; 
                const a3 = a2 + 9;

                // PERBAIKAN: Pisahkan pembuatan string HTML
                document.getElementById('pinnacleBody').innerHTML = `
                    <tr><td>Pinnacle 1</td><td>0 - ${a1}</td><td>${p1}</td><td>${c1}</td></tr>
                    <tr><td>Pinnacle 2</td><td>${a1+1} - ${a2}</td><td>${p2}</td><td>${c2}</td></tr>
                    <tr><td>Pinnacle 3</td><td>${a2+1} - ${a3}</td><td>${p3}</td><td>${c3}</td></tr>
                    <tr><td>Pinnacle 4</td><td>${a3+1}+</td><td>${p4}</td><td>${c4}</td></tr>
                `;

                // GENERATE DETAIL SIKLUS (Kode yang tadi nyangkut dipindah ke sini)
                let details = "";
                details += generateCycleDesc("Fase 1: Masa Pembentukan", `0 - ${a1} Tahun`, p1, c1);
                details += generateCycleDesc("Fase 2: Masa Produktif", `${a1+1} - ${a2} Tahun`, p2, c2);
                details += generateCycleDesc("Fase 3: Masa Kematangan", `${a2+1} - ${a3} Tahun`, p3, c3);
                details += generateCycleDesc("Fase 4: Masa Kebijaksanaan", `${a3+1}+ Tahun`, p4, c4);
                
                document.getElementById('cycleList').innerHTML = details;

                // 9. TAMPILKAN HASIL
                document.getElementById('resultArea').style.display = 'block';
                window.scrollTo({top: document.getElementById('resultArea').offsetTop - 50, behavior:'smooth'});

            } catch (error) {
                console.error(error);
                alert("Terjadi kesalahan: " + error.message);
            }
        }
    </script>
</body>
</html>
